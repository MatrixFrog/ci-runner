<link rel="import" href="../components/core-splitter/core-splitter.html">
<link rel="import" href="../components/core-toolbar/core-toolbar.html">
<link rel="import" href="../components/core-tooltip/core-tooltip.html">
<link rel="import" href="../components/more-param/more-param.html">
<link rel="import" href="../components/paper-tabs/paper-tabs.html">
<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/more-routing/more-route-switch.html">

<link rel="import" href="browser-status.html">
<link rel="import" href="log-entries.html">
<link rel="import" href="test-results.html">

<polymer-element name="commit-status" layout vertical fit attributes="firebaseRoot">
  <template>

    <style>
      #content {
        display: block;
        overflow: auto;
      }

      log-entries {
        margin-right: 1em;
      }
      test-results {
        padding: 1em;
      }

      .image {
        background-size: contain;
        background-repeat: no-repeat;
        background-position: top center;
      }
      .info {
        width: 30%;
        padding: 20px;
      }
      .info > * {
        margin-bottom: 10px;
      }
    </style>

    <paper-tabs id="tabs" selectedIndex="{{activeRoute}}" class="tabs">
      <paper-tab>Run Log</paper-tab>
      <paper-tab>Tests</paper-tab>
    </paper-tabs>

    <more-route-switch id="content" selectedIndex="{{activeRoute}}" flex>

      <template when-route="/log">
        <log-entries firebaseRoot="{{firebaseRoot}}/log" on-entry-added="{{_onEntryAdded}}"></log-entries>
      </template>

      <template else>
        <section layout horizontal>
          <test-results flex firebaseRoot="{{firebaseRoot}}/tests"></test-results>
          <browser-status firebaseRoot="{{firebaseRoot}}/browsers"></browser-status>
        </section>
      </template>

    </more-route-switch>

  </template>

  <script>
    Polymer('commit-status', {
      // TODO(nevir): Not if you've scrolled manually.
      _onEntryAdded: function(event) {
        if (this._scrollingThisFrame) return;
        this._scrollingThisFrame = true;
        requestAnimationFrame(function() {
          this._scrollingThisFrame = false;
          this.$.content.scrollTop = this.$.content.scrollHeight;
        }.bind(this));
      }
    });
  </script>
</polymer-element>
