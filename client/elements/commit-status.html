<link rel="import" href="../components/core-splitter/core-splitter.html">
<link rel="import" href="../components/core-toolbar/core-toolbar.html">
<link rel="import" href="../components/core-tooltip/core-tooltip.html">
<link rel="import" href="../components/firebase-element/firebase-element.html">
<link rel="import" href="../components/more-param/more-param.html">
<link rel="import" href="../components/more-routing/more-route-if.html">
<link rel="import" href="../components/paper-tabs/paper-tabs.html">
<link rel="import" href="../components/polymer/polymer.html">

<link rel="import" href="log-entries.html">
<link rel="import" href="test-results.html">

<polymer-element name="commit-status" layout vertical fit attributes="firebaseApp user repo sha">
  <template>
    <style>
      #content {
        overflow: auto;
      }

      log-entries {
        margin-right: 1em;
      }

      .image {
        background-size: contain;
        background-repeat: no-repeat;
        background-position: top center;
      }
      .info {
        width: 30%;
        padding: 20px;
      }
      .info > * {
        margin-bottom: 10px;
      }
    </style>

    <firebase-element location="https://{{firebaseApp}}.firebaseio.com/status/{{user}}/{{repo}}/{{sha}}"
      data="{{status}}" on-data-change="{{resultsChanged}}"></firebase-element>

    <!-- TODO(nevir): Using routing this way is really awkward. -->
    <more-route id="rLog"   on-more-route-active="{{onRouteActive}}" route="/log"></more-route>
    <more-route id="rTests" on-more-route-active="{{onRouteActive}}" route="/"></more-route>

    <paper-tabs id="tabs" selectedItem="{{activeTab}}" class="tabs">
      <paper-tab ref="rLog">Run Log</paper-tab>
      <paper-tab ref="rTests">Tests</paper-tab>
    </paper-tabs>

    <more-route-switch id="content" on-more-route-changed="{{onRouteChanged}}" flex>
      <template is="more-route-if" route="/log">
        <log-entries firebaseRoot="https://{{firebaseApp}}.firebaseio.com/status/{{user}}/{{repo}}/{{sha}}/log"></log-entries>
      </template>
      <template is="more-route-if" route="/">
        <test-results tests="{{status.tests}}"></test-results>
      </template>
    </more-route-switch>
  </template>

  <script>
    Polymer('commit-status', {
      activeTabChanged: function(prevTab, tab) {
        // TODO(nevir): This is awkward.
        this.$[tab.getAttribute('ref')].navigateTo(
          {user: this.user, repo: this.repo, sha: this.sha}
        );
      },

      onRouteChanged: function(event, detail) {
        this.$.tabs.selected = detail.index;
      },
    });
  </script>
</polymer-element>
